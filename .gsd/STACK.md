# Technology Stack

> Generated by /codebase-mapper on 2026-01-30

## Runtime

| Technology | Version | Purpose |
|---|---|---|
| Python | >=3.12 (local: 3.14.2) | Primary language |
| uv | 0.9.26 | Package manager (pip/poetry 대체) |
| Node.js | >=18 (local: v20.19.6) | code-graph-rag MCP 서버 실행 (npx) |
| direnv | latest | `.env` 자동 로드 (`.envrc` via `dotenv`) |

## Production Dependencies

| Package | Version | Purpose |
|---|---|---|
| mcp | >=1.0.0 | Model Context Protocol SDK |

## Development Dependencies

| Package | Version | Purpose |
|---|---|---|
| pytest | >=8.0 | 테스트 프레임워크 |
| ruff | >=0.8 | 린터 + 포매터 (9종 규칙) |
| mypy | >=1.13 | 정적 타입 체커 |

## External Tools (Non-Python)

| Tool | Purpose | Install |
|---|---|---|
| code-graph-rag | Tree-sitter + SQLite AST 분석 MCP 서버 | `npx -y @er77/code-graph-rag-mcp` (on-demand) |
| mcp-memory-service | 에이전트 영구 기억 MCP 서버 | `pipx install mcp-memory-service` |
| gh CLI | GitHub PR/Issue 관리 | `brew install gh` (optional) |
| Qlty CLI | 멀티언어 린터/포매터 (`qlty check`, `qlty fmt`) | `brew install qltysh/qlty/qlty` (optional) |

## Infrastructure

Docker/Memgraph 의존성 없음. code-graph-rag는 SQLite 기반으로 로컬에서 실행됩니다.

## MCP Servers

| Server | Transport | Tools | Purpose |
|---|---|---|---|
| graph-code | stdio (`npx @er77/code-graph-rag-mcp`) | 19개 도구 (`query`, `semantic_search`, `analyze_code_impact`, `analyze_hotspots`, `detect_code_clones`, `find_similar_code`, `list_file_entities`, `list_entity_relationships`, `suggest_refactoring`, `cross_language_search`, `find_related_concepts`, `index`, `clean_index`, `get_graph`, `get_graph_stats`, `get_graph_health`, `reset_graph`, `get_metrics`, `get_version`) | AST 기반 코드 분석 (Tree-sitter + SQLite) |
| memory | stdio (`memory server`) | 8개 도구 (`memory_store`, `memory_search`, `memory_update`, `memory_delete`, `memory_stats`, `memory_list`, `memory_graph`, `memory_quality`) | 에이전트 영구 기억 (doobidoo/mcp-memory-service, SQLite) |
| Context7 | HTTP | 2개 도구 (`resolve-library-id`, `query-docs`) | 라이브러리 문서 조회 |

**Feature:** `enable_tool_search: true` (도구 탐색 활성화)

## IDE

| Extension | ID | Purpose |
|---|---|---|
| Ruff | charliermarsh.ruff | 린터 + 포매터 (네이티브 서버) |
| Python | ms-python.python | 인터프리터, 디버깅 |
| Mypy Type Checker | ms-python.mypy-type-checker | 타입 체크 (dmypy daemon) |
| Ruff Ignore Explainer | jannchie.ruff-ignore-explainer | 규칙 설명 인라인 표시 |

## Code Quality Configuration

| Tool | Config Location | Key Settings |
|---|---|---|
| Ruff | `pyproject.toml` | E,F,I,N,W,B,C90,PL,TC / line-length=100 / McCabe<=10 / max-args=6 / max-returns=6 / max-statements=50 |
| Qlty | `.qlty/qlty.toml` | 8 plugins (actionlint, bandit, radarlint-python, ripgrep, ruff, shellcheck, trivy, trufflehog) / smells=comment / `project-config.yaml`의 `qlty.enabled`로 활성화 |
| Mypy | `pyproject.toml` | python_version=3.11, warn_return_any=true, warn_unused_configs=true |
| Pytest | `pyproject.toml` | testpaths=["tests"] |
| VS Code | `.vscode/settings.json` | Ruff native server, format-on-save, 100-char ruler, mypy daemon |

**Naming Exceptions:** `*Factory`, `Create*` (N 규칙 면제)
**Ignored Rules:** E501 (line-length), PLR2004 (magic-value-comparison)
**Excluded Dirs:** awesome-claude-code, claude-code-tips, everything-claude-code, ralph

## Claude Code Hooks

| Hook | Trigger | Script | Purpose |
|---|---|---|---|
| bash-guard | PreToolUse:Bash | `.claude/hooks/bash-guard.py` | 파괴적 git + pip/poetry 차단 |
| file-protect | PreToolUse:Edit\|Write\|Read | `.claude/hooks/file-protect.py` | .env/시크릿/인증서 수정 차단 |
| auto-format | PostToolUse:Edit\|Write | `.claude/hooks/auto-format.sh` | Python 자동 포맷 (ruff) |
| track-modifications | PostToolUse:Edit\|Write\|Bash | `.claude/hooks/track-modifications.sh` | 파일 수정 추적 |
| session-start | SessionStart | `.claude/hooks/session-start.sh` | GSD 상태 + git status 주입 |
| pre-compact-save | PreCompact | `.claude/hooks/pre-compact-save.sh` | STATE/JOURNAL 백업 |
| post-turn-index | Stop | `.claude/hooks/post-turn-index.sh` | 턴 종료 시 인덱스 갱신 |
| post-turn-verify | Stop | `.claude/hooks/post-turn-verify.sh` | 턴 종료 시 변경사항 검증 |
| stop-context-save | Stop | `.claude/hooks/stop-context-save.sh` | 턴 종료 시 컨텍스트 저장 |
| save-session-changes | SessionEnd | `.claude/hooks/save-session-changes.sh` | 세션 종료 시 변경사항 저장 |
| save-transcript | SessionEnd | `.claude/hooks/save-transcript.sh` | 세션 종료 시 트랜스크립트 저장 |
| mcp-store-memory | — | `.claude/hooks/mcp-store-memory.sh` | mcp-memory-service 기억 저장 헬퍼 |
| mcp-recall-memory | — | `.claude/hooks/mcp-recall-memory.sh` | mcp-memory-service 기억 조회 헬퍼 |
| _json_parse | — | `.claude/hooks/_json_parse.sh` | JSON 파싱 유틸리티 (공유) |

## Configuration

| Variable | Purpose | Required | Default |
|---|---|---|---|
| PROJECT_ID | 프로젝트 식별자 | Yes | `my_project` |
| MCP_TIMEOUT | code-graph-rag MCP 서버 타임아웃 (ms) | No | `80000` |
| CONTEXT7_API_KEY | Context7 MCP 서버 인증 | No | -- |
| MCP_MEMORY_STORAGE_PATH | mcp-memory-service DB 파일 경로 | No | `.agent/data/memory-service/memories.db` |
| DISABLE_AUTOUPDATER | Claude CLI 자동 업데이트 비활성화 | No | `0` |
| SSL_CERT_FILE | TLS 인증서 (기업 프록시 환경) | No | -- |
| PROJECT_LANGUAGE | 프로젝트 언어 (detect-language.sh 감지) | No | `python` |
| PROJECT_PKG_MANAGER | 패키지 매니저 (detect-language.sh 감지) | No | `uv` |
| QLTY_ENABLED | Qlty CLI 활성화 여부 | No | `false` |

## Build & Run Commands

```bash
# Full Setup (one command)
make setup                    # install-deps → init-env → index

# Prerequisites Check
make check-deps               # node, npm, uv, pipx 확인

# Installation
pipx install mcp-memory-service  # memory server
make install-deps             # 모든 외부 의존성 설치
make init-env                 # .env.example → .env 생성

# Status
make status                   # MCP 도구 + 환경 상태

# Code Indexing
make index                    # code-graph-rag 인덱싱 (npx)

# Code Quality
make lint / make lint-fix     # Ruff 린트/자동수정
make test                     # Pytest 실행
make typecheck                # Mypy 타입체크
make validate                 # SPEC 구조 검증

# System Prompt Patching
make patch-prompt             # Claude CLI 시스템 프롬프트 패치 (~50% 토큰 절감)
make patch-restore            # 원본 복원
make patch-clean              # 패치 워크스페이스 삭제

# Build (Multi-platform)
make build                    # gsd-plugin + antigravity + opencode 전체 빌드
make generate-claude-md       # project-config.yaml → CLAUDE.md 동적 생성

# Quality (Qlty 활성화 시)
# qlty check                   # 멀티언어 린트 (8 plugins)
# qlty fmt                     # 멀티언어 포맷

# Bootstrap
scripts/bootstrap.sh          # 시스템 전제조건 검증
scripts/detect-language.sh    # 프로젝트 언어/패키지매니저 자동 감지

# Cleanup
make clean                    # 인덱스 데이터 + 패치 워크스페이스 삭제
```

## File Inventory

| Category | Count | Location |
|---|---|---|
| GSD Workflows | 31 | `.agent/workflows/` |
| Claude Skills | 16 SKILL.md + 16 scripts | `.claude/skills/` |
| Claude Agents | 13 | `.claude/agents/` |
| Claude Hooks | 14 (2 Python, 12 Shell) | `.claude/hooks/` |
| GSD Templates | 22 | `.gsd/templates/` |
| GSD Examples | 3 | `.gsd/examples/` |
| GSD Documents | 11 | `.gsd/` |
| GitHub (CI + Issues + Agent) | 5 | `.github/` |
| Scripts | 10 | `scripts/` |
| Utility (gsd-stat) | 4 | `src/gsd_stat/` |
| Config Files | 19 | Root (pyproject.toml, .mcp.json, Makefile, etc.) |
| VS Code | 2 | `.vscode/` |
| Gemini | 1 | `.gemini/` |
| **Total (tracked)** | **~166** | Boilerplate only (excludes .gitignore'd repos) |

## Multi-language Support

### Supported Languages

| Language | Marker File | Package Managers | Test Runner | Quality Tool |
|---|---|---|---|---|
| Python | `pyproject.toml`, `setup.py` | uv, poetry, pip | pytest | Ruff, Qlty |
| Node.js | `package.json` | npm, yarn, pnpm, bun | jest, vitest, mocha | ESLint, Qlty |
| Go | `go.mod` | go modules | go test | golangci-lint, Qlty |
| Rust | `Cargo.toml` | cargo | cargo test | clippy, Qlty |

### Detection Flow (Detect-Ask-Confirm)

1. **Detect** — `scripts/detect-language.sh`가 프로젝트 루트를 스캔하여 언어, 패키지매니저, 테스트러너 감지
   - 1차: `qlty.toml` 파싱 (Qlty 설치 시)
   - 2차: marker file fallback (`pyproject.toml`, `package.json`, `go.mod`, `Cargo.toml`)
   - 출력: JSON `{language, variant, version, confidence}`
2. **Ask** — 감지 결과를 사용자에게 확인 요청
3. **Confirm** — `.gsd/project-config.yaml`에 저장, `scripts/load-config.sh`로 환경변수 로드

### Project Configuration (`project-config.yaml`)

```yaml
project:
  name: <project-name>
  language: <python|node|go|rust>
  version: <language-version>
  pkg_manager: <uv|poetry|npm|yarn|pnpm|bun|go|cargo>
qlty:
  enabled: <true|false>
test:
  runner: <pytest|jest|vitest|go test|cargo test>
  command: <full test command>
memory:
  storage_path: .agent/data/memory-service/memories.db
```

### Qlty CLI Integration

- **Config:** `.qlty/qlty.toml` (8 plugins: actionlint, bandit, radarlint-python, ripgrep, ruff, shellcheck, trivy, trufflehog)
- **Commands:** `qlty check` (린트), `qlty fmt` (포맷)
- **Activation:** `project-config.yaml`의 `qlty.enabled: true` 설정 시 Makefile이 Qlty 사용, `false`이면 Ruff 폴백
- **Scope:** 멀티언어 지원 — Python, Shell, YAML, Dockerfile 등 동시 검사

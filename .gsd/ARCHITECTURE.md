# Architecture

> Generated by /map on 2026-01-28 (updated)

## Overview

AI 에이전트 기반 개발을 위한 경량 프로젝트 보일러플레이트. 코드베이스 자체가 아닌 **개발 워크플로우 인프라**를 제공한다. 실제 애플리케이션 코드는 사용자가 GSD 워크플로우를 통해 생성한다.

핵심 구성: code-graph-rag(AST 분석) + memory-graph(에이전트 기억) + MCP(도구 통합) + GSD(문서 기반 방법론) + 멀티 에이전트(Claude, GitHub, Gemini)

## System Diagram

```
┌─────────────────────────────────────────────────────────────┐
│                    Developer / User                         │
└──────────────┬──────────────────────┬───────────────────────┘
               │                      │
       ┌───────▼────────┐    ┌────────▼─────────┐
       │  Claude Code   │    │  GitHub Agent /   │
       │  (14 skills)   │    │  Gemini           │
       └───────┬────────┘    └────────┬──────────┘
               │                      │
       ┌───────▼──────────────────────▼──────────┐
       │           GSD Methodology               │
       │  29 workflows → SPEC → PLAN → EXECUTE   │
       │  .agent/workflows/ + .claude/skills/     │
       └───────┬──────────────────────┬──────────┘
               │                      │
       ┌───────▼────────┐    ┌────────▼──────────┐
       │ code-graph-rag │    │   memory-graph    │
       │ MCP (stdio)    │    │   MCP (stdio)     │
       │ query_code_graph│   │   store/recall    │
       │ index_repository│   │   memories        │
       └───────┬────────┘    └──────────────────┘
               │
       ┌───────▼────────┐    ┌──────────────────┐
       │   Memgraph     │    │   Context7 MCP   │
       │   (Docker)     │    │   (HTTP)          │
       │   :7687        │    │   docs lookup     │
       └────────────────┘    └──────────────────┘
```

## Components

### 1. GSD Workflow Engine
- **Purpose:** 문서 기반 개발 방법론 실행 (SPEC → PLAN → EXECUTE → VERIFY)
- **Location:** `.agent/workflows/` (29 .md files)
- **Subcomponents:**
  - 워크플로우 정의 (29개 슬래시 명령)
    - Core: map, plan, execute, verify, quick-check, debug
    - Project: new-project, new-milestone, help, handoff, web-search
    - Phase: add/remove/insert/discuss/research-phase, list-phase-assumptions
    - Milestone: new/audit/complete-milestone, plan-milestone-gaps
    - Dev: feature-dev, bug-fix
    - Navigation: progress, pause, resume, add-todo, check-todos, update, whats-new
  - 템플릿 라이브러리 (`.gsd/templates/`, 22개)
  - 예제 (`.gsd/examples/`, 3개)
  - 상태 문서 (`.gsd/STATE.md`, `JOURNAL.md`, `TODO.md`)

### 2. Claude Code Skills
- **Purpose:** AI 에이전트의 모듈형 능력 정의
- **Location:** `.claude/skills/` (14 SKILL.md files)
- **Categories:**
  - **Planning (2):** planner, plan-checker
  - **Execution (4):** executor, commit, create-pr, clean
  - **Verification (3):** verifier, empirical-validation, pr-review
  - **Analysis (5):** arch-review, impact-analysis, codebase-mapper, context-health-monitor, debugger

### 3. code-graph-rag + memory-graph + MCP
- **Purpose:** AST 기반 코드 분석 및 에이전트 영구 기억 제공
- **Location:** `.mcp.json`
- **Components:**
  - code-graph-rag (stdio MCP 서버, Tree-sitter + Memgraph)
  - memory-graph (stdio MCP 서버, 그래프 기반 영구 기억)
  - Context7 (HTTP MCP 서버, 라이브러리 문서 조회)
  - Tools: `query_code_graph`, `index_repository`, `store_memory`, `recall_memories`, `search_memories`, `create_domain`, `select_domain`

### 4. Infrastructure
- **Purpose:** 개발 환경 자동화
- **Location:** `docker-compose.yml`, `Makefile`
- **Services:**
  - Memgraph (Docker, port 7687 Bolt / 7444 Lab, volume: memgraph-data)
  - Makefile 타겟 (setup, up, down, index, lint, test, typecheck, validate, clean, patch-prompt/restore/clean)

### 5. Multi-Agent Configuration
- **Purpose:** 동일 GSD 방법론을 3개 에이전트에서 사용
- **Agents:**
  - **Claude Code:** `.claude/skills/`, `CLAUDE.md`, `.claude/settings.local.json`
  - **GitHub Agent:** `.github/agents/agent.md` (9 sections, Senior Staff Engineer role)
  - **Gemini:** `.gemini/GEMINI.md`

### 6. Code Quality Gate
- **Purpose:** 코드 품질 자동 검증
- **Location:** `pyproject.toml`, `.vscode/`
- **Tools:**
  - Ruff (9종 규칙: E,F,I,N,W,B,C90,PL,TC / line-length=100 / McCabe<=10 / max-args=6)
  - Mypy (strict: warn_return_any, warn_unused_configs)
  - Pytest (testpaths=["tests"])
  - VS Code 워크스페이스 설정 (4개 확장 권장)
- **CI/CD:** `.github/workflows/ci.yml` (lint + typecheck + test, Python 3.11-3.13)

### 7. Testing Framework
- **Purpose:** 경험적 검증 기반 품질 보증
- **Location:** `tests/`
- **Structure:**
  - `conftest.py` — 3 fixtures: `db_conn` (in-memory SQLite), `project_root` (Path), `tmp_workspace` (tmp_path)
  - `test_sample.py` — 8 tests: TestProjectStructure (4), TestDatabaseFixture (2), TestTmpWorkspace (2)
- **Philosophy:** mock 최소화, 실제 객체 우선, 테스트별 격리, 외부 API만 mock

### 8. Reference Repositories (외부 참고)
- **Purpose:** Claude Code 생태계 레퍼런스 자료
- **Location:** `awesome-claude-code/`, `claude-code-tips/`, `everything-claude-code/`, `ralph/`
- **Note:** 보일러플레이트 코어가 아닌 참고 자료. `.gitignore`에 포함

## Data Flow

```
User Intent
  → /new-project → .gsd/SPEC.md (requirements lock)
  → /plan N      → Phase execution plan (XML tasks)
  → /execute N   → Source Code + atomic commits
  → /quick-check → Immediate validation (7-step)
  → /verify N    → Verification with empirical evidence
  → /commit      → Conventional emoji commits (logical split)
  → /create-pr   → GitHub Pull Request (structured body)
  → /pr-review   → 6-persona review (Dev, QA, Security, Arch, DevOps, UX)
```

## Integration Points

| External Service | Type | Purpose | Config |
|---|---|---|---|
| Memgraph | Graph DB (Docker) | code-graph-rag 백엔드 스토리지 | `docker-compose.yml` (7687/7444) |
| code-graph-rag | AST Analyzer (stdio) | 코드 분석 MCP 서버 | `.mcp.json`, `.env` |
| memory-graph | Memory Store (stdio) | 에이전트 영구 기억 MCP 서버 | `.mcp.json` |
| Context7 | Docs API (HTTP) | 라이브러리 문서 조회 | `.mcp.json` |
| Gemini API | LLM | Cypher 쿼리 생성 (code-graph-rag) | `.env` (CYPHER_*) |
| GitHub | VCS + CI | 코드 호스팅, 이슈, PR, Actions | `.github/` |

## Conventions

- **Naming:** snake_case (Python), kebab-case (파일/디렉토리), `*Factory`/`Create*` 예외 허용
- **Structure:** `.gsd/`에 워킹 문서, `.gsd/templates/`에 템플릿, `.agent/workflows/`에 명령 정의
- **Testing:** `tests/` 디렉토리, pytest, mock 최소화 정책, 새 기능 = 새 테스트
- **Commits:** conventional commit + emoji, atomic commits per task
- **Package Manager:** uv only (pip/poetry 사용 금지)
- **Validation:** 경험적 증거 기반. 3회 연속 실패 시 접근 방식 변경

## Technical Debt

- [x] `scripts/validate_spec.py` 경로 수정: `.agent/agent.md` → `.github/agents/agent.md`
- [x] `tests/` 스켈레톤 구성 완료: conftest.py (3 fixtures) + test_sample.py (8 tests)
- [x] CI/CD 파이프라인 구성: `.github/workflows/ci.yml` (lint + typecheck + test, Python 3.11-3.13)
- [x] Reference repos `.gitignore`에 추가: `awesome-claude-code/`, `claude-code-tips/`, `everything-claude-code/`, `ralph/`
- [x] `.vscode/` 팀 공유 가능: settings.json + extensions.json 커밋
- [ ] `scripts/validate_spec.py`가 `.specs/` 경로를 검증하지만 실제 GSD 문서는 `.gsd/`에 위치 — 경로 불일치
- [ ] 도메인 로직 없음 — 보일러플레이트 인프라만 존재, 실제 앱 코드 생성 필요
- [ ] MCP 서버 3개 외부 의존 — code-graph-rag, memorygraph, Memgraph 별도 설치 필요

# docker-compose.mcp.yml
# MCP 서버들을 Docker 컨테이너로 실행
#
# 빌드:
#   docker-compose -f docker-compose.mcp.yml build
#
# 개별 서버 실행 (stdio 모드):
#   docker-compose -f docker-compose.mcp.yml run --rm serena
#   docker-compose -f docker-compose.mcp.yml run --rm codanna
#   docker-compose -f docker-compose.mcp.yml run --rm shrimp
#
# 환경 변수:
#   TARGET_PROJECT_PATH: 분석 대상 프로젝트 경로 (기본값: 상위 디렉터리)
#
# 주의:
#   - 각 컨테이너는 stdio를 통해 JSON-RPC 통신을 수행합니다.
#   - mcp-docker-runner.js를 통해 실행하는 것을 권장합니다.

services:
  # Serena MCP - 심볼 기반 코드 검색 및 편집
  serena:
    build:
      context: .
      dockerfile: serena.Dockerfile
    image: mcp-serena:latest
    container_name: mcp-serena
    stdin_open: true
    tty: true
    volumes:
      - ${TARGET_PROJECT_PATH:-..}:/workspace:ro
    working_dir: /workspace
    restart: "no"

  # Codanna MCP - 시맨틱 코드 검색 및 분석
  codanna:
    build:
      context: .
      dockerfile: codanna.Dockerfile
    image: mcp-codanna:latest
    container_name: mcp-codanna
    stdin_open: true
    tty: true
    volumes:
      - ${TARGET_PROJECT_PATH:-..}:/workspace:ro
    working_dir: /workspace
    restart: "no"

  # Shrimp Task Manager - 구조화된 작업 관리
  shrimp:
    build:
      context: .
      dockerfile: shrimp.Dockerfile
    image: mcp-shrimp:latest
    container_name: mcp-shrimp
    stdin_open: true
    tty: true
    volumes:
      - ${TARGET_PROJECT_PATH:-..}:/workspace:ro
      - shrimp-data:/data
    environment:
      - DATA_DIR=/data
      - TEMPLATES_USE=ko
      - ENABLE_GUI=false
    working_dir: /workspace
    restart: "no"

volumes:
  # Shrimp Task Manager 데이터 영속화
  shrimp-data:
    name: mcp-shrimp-data

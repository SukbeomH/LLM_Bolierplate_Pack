{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Log Analyzer Skill Schema",
  "description": "로컬 로그 분석 스킬의 입력/출력 인터페이스 정의",
  "type": "object",
  "properties": {
    "input": {
      "type": "object",
      "description": "스킬 입력 파라미터",
      "properties": {
        "target_directory": {
          "type": "string",
          "description": "프로젝트 루트 디렉토리 경로 (선택적)"
        },
        "log_file_path": {
          "type": "string",
          "description": "분석할 로그 파일 경로 (선택적, 기본값: app.log)",
          "default": "app.log"
        }
      },
      "additionalProperties": false
    },
    "output": {
      "type": "object",
      "description": "스킬 출력 결과",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["passed", "failed"],
          "description": "분석 결과 상태 (failed: ERROR/CRITICAL 발견, passed: 심각한 에러 없음)"
        },
        "summary": {
          "type": "object",
          "description": "분석 요약",
          "properties": {
            "error_count": {
              "type": "integer",
              "description": "에러 로그 개수",
              "minimum": 0
            },
            "critical_count": {
              "type": "integer",
              "description": "크리티컬 로그 개수",
              "minimum": 0
            },
            "warning_count": {
              "type": "integer",
              "description": "경고 로그 개수",
              "minimum": 0
            },
            "has_severe_errors": {
              "type": "boolean",
              "description": "심각한 에러 존재 여부 (ERROR 또는 CRITICAL 로그가 있으면 true)"
            }
          },
          "required": ["error_count", "critical_count", "warning_count", "has_severe_errors"],
          "additionalProperties": false
        },
        "errors": {
          "type": "array",
          "description": "에러 로그 목록 (최대 10개)",
          "items": {
            "type": "object",
            "properties": {
              "timestamp": {
                "type": "string"
              },
              "levelname": {
                "type": "string",
                "enum": ["ERROR"]
              },
              "module": {
                "type": "string",
                "nullable": true
              },
              "funcName": {
                "type": "string",
                "nullable": true
              },
              "lineno": {
                "type": "integer",
                "nullable": true
              },
              "message": {
                "type": "string",
                "description": "에러 메시지 (민감 정보 마스킹됨)"
              },
              "line_number": {
                "type": "integer",
                "description": "로그 파일 내 라인 번호"
              }
            },
            "required": ["timestamp", "levelname", "message", "line_number"],
            "additionalProperties": true
          }
        },
        "criticals": {
          "type": "array",
          "description": "크리티컬 로그 목록 (최대 10개)",
          "items": {
            "type": "object",
            "properties": {
              "levelname": {
                "type": "string",
                "enum": ["CRITICAL"]
              }
            },
            "additionalProperties": true
          }
        },
        "warnings": {
          "type": "array",
          "description": "경고 로그 목록 (최대 10개)"
        },
        "code_analysis_guides": {
          "type": "array",
          "description": "ERROR/CRITICAL 로그에 대한 코드 분석 가이드",
          "items": {
            "type": "object",
            "properties": {
              "log_entry": {
                "type": "object"
              },
              "analysis_guides": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "tool": {
                      "type": "string",
                      "enum": ["Codanna", "Serena"]
                    },
                    "action": {
                      "type": "string"
                    },
                    "query": {
                      "type": "string"
                    },
                    "description": {
                      "type": "string"
                    }
                  },
                  "required": ["tool", "action", "description"],
                  "additionalProperties": false
                }
              }
            },
            "required": ["log_entry", "analysis_guides"],
            "additionalProperties": false
          }
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "분석 실행 시각 (ISO 8601 형식)"
        }
      },
      "required": ["status", "summary", "errors", "criticals", "warnings", "code_analysis_guides", "timestamp"],
      "additionalProperties": false
    }
  }
}

